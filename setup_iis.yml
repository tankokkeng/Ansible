---
- name: Setup Windows Server
  hosts: IIS
  tasks:
    - name: Rename the server
      win_hostname:
        name: PS-IIS01
      register: rename_result

    - name: Reboot the server if necessary
      win_reboot:
        when: rename_result.reboot_required
        msg: "Rebooting the server after renaming"
        pre_reboot_delay: 0
        post_reboot_delay: 120  # Wait for 2 minutes (120 seconds) after reboot

    - name: Install IIS
      win_feature:
        name: Web-Server
        state: present

    - name: Install ASP.NET
      win_feature:
        name: Web-Asp-Net45
        state: present

    - name: Install Chocolatey
      win_chocolatey:
        name: chocolatey
        state: present
